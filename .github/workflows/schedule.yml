name: 'Github Action Auto Sign In'
on:
  push:
    branches:
      - master
  schedule:
    - cron: '0 */3 * * *'
jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js 14.x
        uses: actions/setup-node@v1
        with:
          node-version: '14'
      - run: yarn
      - run: yarn build
      - run: yarn start
        env:
          ACCOUNT: ${{secrets.USERNAME}}
          PASSWORD: ${{secrets.PASSWORD}}
          PROVINCE: ${{secrets.PROVINCE}}
          CITY: ${{secrets.CITY}}
          AREA: ${{secrets.AREA}}
      - name: 'Get Date'
        run: echo "$(TZ=':Asia/Shanghai' date '+%Y年%m月%d日')" >> $GITHUB_ENV
      - name: 'Send Email'
        uses: dawidd6/action-send-mail@master
        with:
          serveraddress: smtp.qq.com
          serverport: 465
          username: ${{ secrets.MAILUSERNAME }}
          password: ${{ secrets.MAILPASSWORD }}
          subject: ${{ env.GITHUB_ENV }}的ISP打卡结果
          body: file://./static/index.html
          to: ${{ secrets.MAILUSERNAME }}
          from: Github Actions Job Result <${{ secrets.MAILUSERNAME }}>
          content_type: text/html